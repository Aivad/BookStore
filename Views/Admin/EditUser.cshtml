@model BookStore.Models.ApplicationUser
@{
    Layout = "_AdminLayout";
    ViewData["Title"] = "Edit User";
}

<h2>Edit User</h2>

<form asp-action="EditUser" method="post">
    <input type="hidden" asp-for="Id" />
    <input type="hidden" asp-for="ConcurrencyStamp" />
    <input type="hidden" asp-for="SecurityStamp" />

    <div class="mb-3">
        <label asp-for="UserName" class="form-label">Username</label>
        <input asp-for="UserName" class="form-control" />
        <span asp-validation-for="UserName" class="text-danger"></span>
    </div>

    <div class="mb-3">
        <label asp-for="Email" class="form-label">Email</label>
        <input asp-for="Email" class="form-control" />
        <span asp-validation-for="Email" class="text-danger"></span>
    </div>

    <div class="mb-3">
        <label class="form-label">New Password (optional)</label>
        <input name="NewPassword" class="form-control" placeholder="Leave blank to keep current password" />
    </div>

    <div class="mb-3">
        <label class="form-label">Confirm New Password</label>
        <input name="ConfirmPassword" class="form-control" placeholder="Re-enter new password" />
        <span id="password-error" class="text-danger"></span>
    </div>

    <div class="mb-3">
        <label class="form-label">Role</label><br />
        @{
            var userRole = Model.UserRoles?.FirstOrDefault()?.Role?.Name ?? "User";
        }
        <div class="form-check form-check-inline">
            <input class="form-check-input" type="radio" name="SelectedRole" value="Admin" id="roleAdmin" @(userRole == "Admin" ? "checked" : "")>
            <label class="form-check-label" for="roleAdmin">Admin</label>
        </div>
        <div class="form-check form-check-inline">
            <input class="form-check-input" type="radio" name="SelectedRole" value="User" id="roleUser" @(userRole == "User" ? "checked" : "")>
            <label class="form-check-label" for="roleUser">User</label>
        </div>
    </div>

    <button type="submit" class="btn btn-primary">Save Changes</button>
    <a asp-action="IndexUser" class="btn btn-secondary">Cancel</a>
</form>

@section Scripts {
    <partial name="_ValidationScriptsPartial" />
    <script>
        document.querySelector('form').addEventListener('submit', function (e) {
            const newPassword = document.querySelector('[name="NewPassword"]').value;
            const confirmPassword = document.querySelector('[name="ConfirmPassword"]').value;
            const errorSpan = document.getElementById('password-error');

            if (newPassword && newPassword !== confirmPassword) {
                e.preventDefault();
                errorSpan.textContent = "Passwords do not match.";
            } else {
                errorSpan.textContent = "";
            }
        });
    </script>
}